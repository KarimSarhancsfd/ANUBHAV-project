<nav class="main-nav">
  <!-- Logo Container -->
  <div class="logo-container">
    <a routerLink="/" (click)="closeMenu()" class="text-3xl font-bold font-cinzel text-[#FFD97D] hover:text-white transition-colors duration-300 transform hover:scale-105">
      XAE
    </a>
  </div>

  <!-- Desktop Menu -->
  <div class="hidden md:flex items-center gap-x-8">
    @for (link of navLinks; track link.path) {
      <a [routerLink]="link.path" routerLinkActive="active" 
         [routerLinkActiveOptions]="{exact: true}"
         class="nav-link">
         {{ translationService.translate(link.labelKey) }}
      </a>
    }
  </div>

  <!-- Actions Container -->
  <div class="actions-container">
    <!-- Language Selector -->
    <div class="relative">
      <button (click)="toggleLangDropdown()" class="action-button">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a8 8 0 100 16 8 8 0 000-16zM2 10a8 8 0 1116 0 8 8 0 01-16 0z" /><path d="M12.25 11.25a.75.75 0 100-1.5.75.75 0 000 1.5zM10.5 10a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM10 12.25a.75.75 0 100 1.5.75.75 0 000-1.5zM7.75 11.25a.75.75 0 100-1.5.75.75 0 000 1.5zM10 7.75a.75.75 0 100-1.5.75.75 0 000 1.5z" /></svg>
        <span>{{ translationService.currentLang().toUpperCase() }}</span>
      </button>
      @if (isLangDropdownOpen()) {
        <div @dropdownAnimation class="lang-dropdown absolute right-0 mt-4 w-36 bg-gray-900/80 backdrop-blur-md rounded-md shadow-lg py-1 z-50 border border-white/10">
          @for (lang of languages; track lang.code) {
            <a href="#" (click)="$event.preventDefault(); changeLanguage(lang.code)" 
               class="lang-item block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700/50 hover:text-white">
               {{ lang.label }}
            </a>
          }
        </div>
      }
    </div>

    <!-- Music Toggle -->
    <button (click)="toggleMusic()" class="action-button music-toggle" [class.playing]="isMusicPlaying()">
      @if(isMusicPlaying()) {
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.636 5.636a9 9 0 0112.728 0m-12.728 0A9 9 0 015.636 5.636m0 12.728A9 9 0 015.636 5.636m0 12.728L18.364 5.636" /></svg>
      } @else {
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.002 1.949l-3.126 1.564a2.25 2.25 0 01-2.474 0L5.38 16.32a2.25 2.25 0 01-1.002-1.95V8.72c0-.994.658-1.84 1.59-2.122l3.126-1.042a2.25 2.25 0 012.474 0l.529.176" /></svg>
      }
    </button>
    
    <!-- Download Button -->
    <a routerLink="/download" class="download-button">
      {{ translationService.translate('nav.download') }}
    </a>
  </div>

  <!-- Mobile Menu Button -->
  <div class="md:hidden">
    <button (click)="toggleMenu()" class="text-gray-300 focus:outline-none p-2">
      <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        @if (!isMenuOpen()) {
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
        } @else {
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        }
      </svg>
    </button>
  </div>
</nav>

<!-- Mobile Menu -->
@if (isMenuOpen()) {
  <div class="md:hidden bg-gray-900/80 backdrop-blur-lg absolute top-[calc(100%+0.5rem)] left-0 w-full rounded-2xl border border-white/10 shadow-xl fade-in">
    <div class="flex flex-col items-center py-6 space-y-5">
      @for (link of navLinks; track link.path) {
        <a [routerLink]="link.path" routerLinkActive="text-[#FFD97D]" [routerLinkActiveOptions]="{exact: true}"
           class="text-gray-200 hover:text-white transition-colors text-lg" (click)="closeMenu()">
           {{ translationService.translate(link.labelKey) }}
        </a>
      }
      <div class="pt-5 mt-5 border-t border-gray-700 w-full flex flex-col items-center space-y-2 px-8">
        <button (click)="toggleLangDropdown()" class="text-gray-200 hover:text-white transition-colors text-lg w-full flex justify-between items-center py-2">
            <span>{{ currentLanguageLabel() }}</span>
            <svg class="w-5 h-5 transition-transform duration-300" [class.rotate-180]="isLangDropdownOpen()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
        </button>
        @if (isLangDropdownOpen()) {
            <div @mobileListAnimation class="w-full flex flex-col items-center space-y-2 pt-2 mobile-lang-list">
                @for (lang of languages; track lang.code) {
                    @if (lang.code !== translationService.currentLang()) {
                        <button (click)="changeLanguage(lang.code)" 
                                class="mobile-lang-item text-gray-300 hover:text-[#FFD97D] text-base w-full py-1 transition-colors">
                            {{ lang.label }}
                        </button>
                    }
                }
            </div>
        }
      </div>
      <a routerLink="/download" (click)="closeMenu()" class="bg-[#E18D5C] text-white font-bold py-3 px-8 rounded-md hover:bg-[#d47845] btn-cta-glow mt-4">
        {{ translationService.translate('nav.download') }}
      </a>
    </div>
  </div>
}